{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Black Mirror Manifest Schema",
  "description": "JSON Schema for Black Mirror manifest files defining blacklist/whitelist sources",
  "type": "object",
  "patternProperties": {
    "^[a-zA-Z0-9_-]+$": {
      "type": "object",
      "properties": {
        "active": {
          "type": "boolean",
          "description": "Whether this source is currently active and should be processed"
        },
        "checksums": {
          "type": "object",
          "description": "Checksums for verifying source integrity (currently unused)",
          "additionalProperties": {
            "type": "string"
          }
        },
        "content": {
          "type": "object",
          "properties": {
            "filter": {
              "type": "string",
              "description": "Content filtering strategy to apply"
            },
            "retriever": {
              "type": "string",
              "description": "Download tool to use for retrieving the source"
            },
            "type": {
              "type": "string",
              "enum": ["TEXT", "JSON", "CSV", "YAML"],
              "description": "Content type of the source"
            }
          },
          "required": ["filter", "retriever", "type"],
          "additionalProperties": false
        },
        "formats": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "filter": {
                "type": "string",
                "description": "Format-specific filtering to apply"
              },
              "format": {
                "type": "string",
                "enum": ["DOMAIN", "IPV4", "CIDR4", "IPV6", "CIDR6"],
                "description": "Output format for the processed data"
              }
            },
            "required": ["filter", "format"],
            "additionalProperties": false
          },
          "minItems": 1,
          "description": "List of output formats and their processing rules"
        },
        "metadata": {
          "type": "object",
          "properties": {
            "description": {
              "type": "string",
              "description": "URL to the source's description or documentation"
            },
            "homepage": {
              "type": "string",
              "description": "URL to the source's homepage"
            },
            "license": {
              "type": "string",
              "description": "License identifier for the source (e.g., 'mpl-2.0', 'agpl-3.0')"
            }
          },
          "required": ["description", "homepage", "license"],
          "additionalProperties": true,
          "description": "Metadata about the source"
        },
        "method": {
          "type": "string",
          "enum": ["ALLOW", "BLOCK"],
          "description": "Whether this source defines entries to allow or block"
        },
        "mirrors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "description": "List of URLs where the source can be downloaded"
        },
        "topic": {
          "type": "string",
          "description": "Category/topic this source addresses"
        },
        "variants": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z0-9_-]+$": {
              "type": "string",
              "description": "Variant-specific URL for this source"
            }
          },
          "description": "Platform-specific or variant URLs for this source"
        }
      },
      "required": [
        "checksums",
        "content",
        "formats",
        "metadata",
        "method",
        "mirrors",
        "topic"
      ],
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
